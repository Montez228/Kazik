<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–õ–ê–ì–û–î–Ü–ô–ù–ï –ö–ê–ó–ò–ù–û</title>
    <!-- Tailwind CSS v3 via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Supabase JS via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Canvas Confetti via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: radial-gradient(circle at top right, #1e1b4b 0%, #020617 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .neon-border {
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.4), inset 0 0 5px rgba(168, 85, 247, 0.2);
            border: 1px solid rgba(168, 85, 247, 0.5);
        }

        .neon-text {
            text-shadow: 0 0 10px rgba(168, 85, 247, 0.8), 0 0 20px rgba(168, 85, 247, 0.4);
        }

        .glass {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .slot-container {
            perspective: 1000px;
        }

        .reel {
            transition: transform 0.1s linear;
        }

        .blur-effect {
            filter: blur(4px);
        }

        @keyframes bounce-win {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0) scale(1);
            }

            40% {
                transform: translateY(-20px) scale(1.1);
            }

            60% {
                transform: translateY(-10px) scale(1.05);
            }
        }

        .animate-win {
            animation: bounce-win 1s ease infinite;
        }
    </style>
</head>

<body class="flex flex-col items-center">

    <!-- Auth Screen -->
    <div id="auth-screen" class="fixed inset-0 z-50 flex items-center justify-center p-6 bg-slate-950">
        <div class="glass p-12 rounded-[3rem] w-full max-w-md text-center neon-border animate-fade-in">
            <h1 class="text-6xl font-black italic neon-text mb-2 tracking-tighter">CASINO</h1>
            <p class="text-purple-400 font-bold tracking-widest text-xs mb-10 uppercase italic">Charity Edition</p>

            <div class="relative mb-8">
                <input type="text" id="nickname-input" placeholder="–í–í–ï–î–Ü–¢–¨ –ù–Ü–ö–ù–ï–ô–ú"
                    class="w-full bg-slate-900/50 border border-white/10 p-5 rounded-2xl outline-none focus:border-purple-500 text-center text-xl font-black transition-all placeholder:text-slate-600">
            </div>

            <button onclick="handleLogin()" id="login-btn"
                class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white font-black p-5 rounded-2xl hover:scale-[1.02] active:scale-95 transition-all text-xl shadow-[0_10px_30px_rgba(147,51,234,0.3)]">
                –ü–û–ß–ê–¢–ò –ì–†–£
            </button>
            <p id="auth-status" class="mt-4 text-xs text-slate-500 font-bold"></p>
        </div>
    </div>

    <!-- Main Game Section (Hidden by default) -->
    <div id="game-screen" class="hidden w-full max-w-7xl p-4 md:p-10 flex flex-col items-center min-h-screen">

        <!-- Top Navigation -->
        <div class="w-full flex flex-wrap justify-between items-center mb-16 gap-8">
            <div>
                <h1 class="text-5xl font-black italic neon-text tracking-tighter">KAZIK</h1>
                <p class="text-[10px] text-purple-400 font-bold tracking-widest uppercase">Charity Slots v2.0</p>
            </div>

            <div class="flex items-center gap-6 glass px-8 py-4 rounded-[2rem] border border-white/10 shadow-xl">
                <div class="text-right">
                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter mb-1">–ì—Ä–∞–≤–µ—Ü—å</p>
                    <p id="display-nick" class="font-black text-purple-400 text-xl tracking-tight">---</p>
                </div>
                <div class="h-10 w-[1px] bg-white/10"></div>
                <div class="text-right">
                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter mb-1">–°–ø—ñ–Ω–∏</p>
                    <p id="display-spins" class="font-black text-blue-400 text-2xl tracking-tighter">0</p>
                </div>
                <div class="h-10 w-[1px] bg-white/10"></div>
                <div class="text-right">
                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter mb-1">–ë–∞–ª–∏</p>
                    <p id="display-points" class="font-black text-yellow-400 text-2xl tracking-tighter">0</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-10 w-full">

            <!-- Leaderboard Column (Left) -->
            <div class="lg:col-span-1 order-2 lg:order-1">
                <div class="glass p-8 rounded-[2.5rem] border border-white/5 h-full relative overflow-hidden">
                    <div
                        class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-purple-500 to-transparent opacity-30">
                    </div>
                    <h3
                        class="text-2xl font-black mb-8 italic text-purple-400 uppercase tracking-tighter flex items-center gap-2">
                        <span>üèÜ</span> TOP RIDERS
                    </h3>
                    <div id="leaderboard-list" class="space-y-4">
                        <!-- Loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- Slot Center (Middle) -->
            <div class="lg:col-span-3 order-1 lg:order-2 flex flex-col items-center">
                <div class="relative group">
                    <!-- Glow effect -->
                    <div
                        class="absolute -inset-1 bg-gradient-to-r from-purple-600 to-blue-600 rounded-[4.5rem] blur opacity-25 group-hover:opacity-40 transition duration-1000">
                    </div>

                    <div
                        class="glass p-10 md:p-16 rounded-[4rem] border-4 border-purple-500/20 bg-slate-950/80 relative flex flex-col items-center shadow-2xl">

                        <div class="flex gap-4 md:gap-10 mb-14 slot-container">
                            <div
                                class="w-28 h-40 md:w-44 md:h-64 bg-slate-900 rounded-[2rem] flex items-center justify-center text-6xl md:text-8xl border border-white/5 relative overflow-hidden shadow-inner">
                                <div id="reel-1" class="reel">üçí</div>
                                <div
                                    class="absolute inset-x-0 top-0 h-10 bg-gradient-to-b from-black/80 to-transparent pointer-events-none">
                                </div>
                                <div
                                    class="absolute inset-x-0 bottom-0 h-10 bg-gradient-to-t from-black/80 to-transparent pointer-events-none">
                                </div>
                            </div>
                            <div
                                class="w-28 h-40 md:w-44 md:h-64 bg-slate-900 rounded-[2rem] flex items-center justify-center text-6xl md:text-8xl border border-white/5 relative overflow-hidden shadow-inner">
                                <div id="reel-2" class="reel">üçã</div>
                                <div
                                    class="absolute inset-x-0 top-0 h-10 bg-gradient-to-b from-black/80 to-transparent pointer-events-none">
                                </div>
                                <div
                                    class="absolute inset-x-0 bottom-0 h-10 bg-gradient-to-t from-black/80 to-transparent pointer-events-none">
                                </div>
                            </div>
                            <div
                                class="w-28 h-40 md:w-44 md:h-64 bg-slate-900 rounded-[2rem] flex items-center justify-center text-6xl md:text-8xl border border-white/5 relative overflow-hidden shadow-inner">
                                <div id="reel-3" class="reel">üçâ</div>
                                <div
                                    class="absolute inset-x-0 top-0 h-10 bg-gradient-to-b from-black/80 to-transparent pointer-events-none">
                                </div>
                                <div
                                    class="absolute inset-x-0 bottom-0 h-10 bg-gradient-to-t from-black/80 to-transparent pointer-events-none">
                                </div>
                            </div>
                        </div>

                        <button onclick="spin()" id="spin-btn"
                            class="w-full py-8 rounded-[2.5rem] bg-gradient-to-b from-purple-500 to-purple-700 text-white font-black text-4xl shadow-[0_20px_50px_rgba(147,51,234,0.4)] hover:scale-[1.02] active:scale-95 transition-all uppercase italic tracking-tighter border-t border-white/20">
                            –ö–†–£–¢–ò–¢–ò
                        </button>

                        <!-- Win Message -->
                        <div id="win-overlay" class="hidden mt-8 text-center animate-win">
                            <p class="text-4xl font-black text-yellow-400 italic drop-shadow-[0_0_15px_rgba(251,191,36,0.6)]"
                                id="win-text">–í–ï–õ–ò–ö–ò–ô –í–ò–ì–†–ê–®! +0</p>
                        </div>
                    </div>
                </div>

                <!-- Game Info -->
                <div class="mt-12 w-full grid grid-cols-5 gap-4">
                    <div class="glass p-4 rounded-2xl text-center border border-white/5">
                        <span class="text-3xl block mb-2">üçí</span>
                        <span class="text-[10px] font-bold text-slate-500 uppercase">+50 PTS</span>
                    </div>
                    <div class="glass p-4 rounded-2xl text-center border border-white/5">
                        <span class="text-3xl block mb-2">üçã</span>
                        <span class="text-[10px] font-bold text-slate-500 uppercase">+100 PTS</span>
                    </div>
                    <div class="glass p-4 rounded-2xl text-center border border-white/5">
                        <span class="text-3xl block mb-2">üçâ</span>
                        <span class="text-[10px] font-bold text-slate-500 uppercase">+250 PTS</span>
                    </div>
                    <div class="glass p-4 rounded-2xl text-center border border-white/5">
                        <span class="text-3xl block mb-2">üíé</span>
                        <span class="text-[10px] font-bold text-slate-500 uppercase">+500 PTS</span>
                    </div>
                    <div class="glass p-4 rounded-2xl text-center border border-white/5">
                        <span class="text-3xl block mb-2">7Ô∏è‚É£</span>
                        <span class="text-[10px] font-bold text-slate-500 uppercase">+1000 PTS</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden Admin Area (Just for testing convenience) -->
    <div
        class="mt-auto py-10 opacity-10 hover:opacity-50 transition-all cursor-default text-[10px] tracking-widest text-slate-600">
        ¬© 2026 BENEVOLENT CASINO INFRASTRUCTURE ‚Ä¢ ALL DATA TO SUPABASE
    </div>

    <script>
        // Supabase Infrastructure
        const SUPABASE_URL = 'https://huhilljlthphkmvgyqlv.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh1aGlsbGpsdGhwaGttdmd5cWx2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4NzY5NzYsImV4cCI6MjA4NzQ1Mjk3Nn0.OgAcEX5nmEAHwONTLEhF5t_2v6yOdTYIWs5cy9tBpBw';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const EMOJIS = ['üçí', 'üçã', 'üçâ', 'üíé', '7Ô∏è‚É£'];
        const REWARDS = { 'üçí': 50, 'üçã': 100, 'üçâ': 250, 'üíé': 500, '7Ô∏è‚É£': 1000 };

        let currentUser = null;
        let isSpinning = false;

        // Audio Context for Synth
        const AudioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSynthSound(freq, type, duration, vol) {
            const osc = AudioCtx.createOscillator();
            const gain = AudioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, AudioCtx.currentTime);
            gain.gain.setValueAtTime(vol, AudioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, AudioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(AudioCtx.destination);
            osc.start();
            osc.stop(AudioCtx.currentTime + duration);
        }

        const $ = id => document.getElementById(id);

        async function handleLogin() {
            const nick = $('nickname-input').value.trim();
            if (!nick) return;

            $('login-btn').innerText = '–ü–ï–†–ï–í–Ü–†–ö–ê...';
            $('auth-status').innerText = '–ü—ñ–¥–∫–ª—é—á–∞—î–º–æ—Å—å –¥–æ —Å–µ—Ä–≤–µ—Ä–∞...';

            try {
                console.log('–ü–æ—á–∞—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –¥–ª—è:', nick);

                // 1. –°–ø—Ä–æ–±—É—î–º–æ –∑–Ω–∞–π—Ç–∏ —ñ—Å–Ω—É—é—á–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                let { data, error } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('nickname', nick);

                if (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø–æ—à—É–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:', error);
                    throw error;
                }

                if (!data || data.length === 0) {
                    // 2. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ–º–∞—î - —Å—Ç–≤–æ—Ä—é—î–º–æ
                    console.log('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –ø—Ä–æ—Ñ—ñ–ª—å...');
                    $('auth-status').innerText = '–°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –ø—Ä–æ—Ñ—ñ–ª—å...';

                    const { data: newUser, error: createError } = await supabaseClient
                        .from('profiles')
                        .insert([{ nickname: nick, spins: 0, points: 0 }])
                        .select();

                    if (createError) {
                        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—é:', createError);
                        throw createError;
                    }

                    if (!newUser || newUser.length === 0) {
                        throw new Error('–°–µ—Ä–≤–µ—Ä –Ω–µ –ø–æ–≤–µ—Ä–Ω—É–≤ –¥–∞–Ω—ñ –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è');
                    }

                    data = newUser;
                }

                // Supabase –ø–æ–≤–µ—Ä—Ç–∞—î –º–∞—Å–∏–≤ –ø—Ä–∏ select/insert –±–µ–∑ .single()
                currentUser = Array.isArray(data) ? data[0] : data;
                console.log('–£—Å–ø—ñ—à–Ω–∏–π –≤—Ö—ñ–¥:', currentUser);

                switchToGame();
                initRealtime();
            } catch (err) {
                console.error('–ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó:', err);
                $('auth-status').innerText = '–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É. –î–µ—Ç–∞–ª—ñ –≤ –∫–æ–Ω—Å–æ–ª—ñ.';
                $('login-btn').innerText = '–ü–û–ß–ê–¢–ò –ì–†–£';
            }
        }

        function switchToGame() {
            $('auth-screen').style.display = 'none';
            $('game-screen').classList.remove('hidden');
            updateUserUI();
            updateLeaderboard();
        }

        function updateUserUI() {
            if (!currentUser) return;
            $('display-nick').innerText = currentUser.nickname;
            $('display-spins').innerText = currentUser.spins;
            $('display-points').innerText = currentUser.points;

            const btn = $('spin-btn');
            if (currentUser.spins <= 0) {
                btn.classList.add('opacity-40', 'pointer-events-none');
                btn.innerText = '–ù–ï–ú–ê–Ñ –°–ü–Ü–ù–Ü–í';
            } else {
                btn.classList.remove('opacity-40', 'pointer-events-none');
                btn.innerText = '–ö–†–£–¢–ò–¢–ò';
            }
        }

        function initRealtime() {
            // My profile updates
            supabaseClient.channel(`my-profile-${currentUser.id}`)
                .on('postgres_changes', { event: 'UPDATE', table: 'profiles', filter: `id=eq.${currentUser.id}` }, payload => {
                    currentUser = payload.new;
                    updateUserUI();
                })
                .subscribe();

            // All updates for leaderboard
            supabaseClient.channel('leaderboard-room')
                .on('postgres_changes', { event: '*', table: 'profiles' }, () => {
                    updateLeaderboard();
                })
                .subscribe();
        }

        async function updateLeaderboard() {
            const { data } = await supabaseClient.from('profiles').select('nickname, points').order('points', { ascending: false }).limit(10);
            if (data) {
                $('leaderboard-list').innerHTML = data.map((u, i) => `
                    <div class="flex justify-between items-center p-4 ${u.nickname === currentUser?.nickname ? 'bg-purple-500/10 border-purple-500/30' : 'bg-white/5 border-transparent'} rounded-2xl border transition-all">
                        <div class="flex items-center gap-3">
                            <span class="text-xs font-black opacity-30">#${i + 1}</span>
                            <span class="font-bold text-sm truncate max-w-[80px]">${u.nickname}</span>
                        </div>
                        <span class="font-black text-yellow-400 text-sm tracking-tighter">${u.points.toLocaleString()}</span>
                    </div>
                `).join('');
            }
        }

        async function spin() {
            if (isSpinning || currentUser.spins <= 0) return;

            isSpinning = true;
            $('win-overlay').classList.add('hidden');

            // Deduct spin in DB
            const { error } = await supabaseClient.from('profiles').update({ spins: currentUser.spins - 1 }).eq('id', currentUser.id);
            if (error) {
                isSpinning = false;
                return;
            }

            // Start Audio Synth
            playSynthSound(100, 'square', 0.5, 0.1);

            const reels = [$('reel-1'), $('reel-2'), $('reel-3')];
            const finalResults = [
                EMOJIS[Math.floor(Math.random() * EMOJIS.length)],
                EMOJIS[Math.floor(Math.random() * EMOJIS.length)],
                EMOJIS[Math.floor(Math.random() * EMOJIS.length)]
            ];

            // Interval based rolling
            const start = Date.now();
            const duration = 1500;

            const timer = setInterval(() => {
                const elapsed = Date.now() - start;

                reels.forEach((reel, i) => {
                    if (elapsed < duration - (i * 400)) {
                        reel.innerText = EMOJIS[Math.floor(Math.random() * EMOJIS.length)];
                        reel.classList.add('blur-effect');
                        if (Math.random() > 0.8) playSynthSound(200 + i * 100, 'sine', 0.05, 0.05);
                    } else {
                        reel.innerText = finalResults[i];
                        reel.classList.remove('blur-effect');
                    }
                });

                if (elapsed > duration + 500) {
                    clearInterval(timer);
                    finishSpin(finalResults);
                }
            }, 100);
        }

        async function finishSpin(results) {
            isSpinning = false;

            if (results[0] === results[1] && results[1] === results[2]) {
                const reward = REWARDS[results[0]];

                // Audio Win
                playSynthSound(440, 'triangle', 0.5, 0.2);
                setTimeout(() => playSynthSound(554, 'triangle', 0.5, 0.2), 150);
                setTimeout(() => playSynthSound(659, 'triangle', 0.7, 0.2), 300);

                // UI Win
                confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 }, colors: ['#a855f7', '#fbbf24', '#3b82f6'] });
                $('win-text').innerText = `–í–ò –í–ò–ì–†–ê–õ–ò +${reward} –ë–ê–õ–Ü–í!`;
                $('win-overlay').classList.remove('hidden');

                // Update DB Points
                await supabaseClient.from('profiles').update({ points: currentUser.points + reward }).eq('id', currentUser.id);
            } else {
                playSynthSound(50, 'sawtooth', 0.3, 0.05);
            }
        }

        // Handle Enter key for login
        $('nickname-input').addEventListener('keypress', e => {
            if (e.key === 'Enter') handleLogin();
        });
    </script>
</body>

</html>